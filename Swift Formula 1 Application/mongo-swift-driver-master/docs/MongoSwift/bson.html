<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BSON  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="BSON  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          MongoSwift 1.0.0-rc0 Docs
        </a>
         (99% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/mongodb/mongo-swift-driver">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fmongodb%2Egithub%2Eio%2Fmongo%2Dswift%2Ddriver%2Fdocs%2FMongoSwift%2Fdocsets%2FMongoSwift%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">MongoSwift Reference</a>
      <img class="carat" src="img/carat.png" />
      BSON  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="bson.html">BSON</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="change-streams.html">Change-Streams</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="development.html">Development</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="error-handling.html">Error-Handling</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="multithreaded-usage.html">Multithreaded-Usage</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder.html">BSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DateDecodingStrategy.html">– DateDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/UUIDDecodingStrategy.html">– UUIDDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DataDecodingStrategy.html">– DataDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder.html">BSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DateEncodingStrategy.html">– DateEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/UUIDEncodingStrategy.html">– UUIDEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DataEncodingStrategy.html">– DataEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ChangeStream.html">ChangeStream</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClientSession.html">ClientSession</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/DocumentIterator.html">DocumentIterator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes.html#/s:10MongoSwift15DocumentStorageC">DocumentStorage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MongoClient.html">MongoClient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MongoCursor.html">MongoCursor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ReadPreference.html">ReadPreference</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ReadPreference/Mode.html">– Mode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSON.html">BSON</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONType.html">BSONType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CollectionType.html">CollectionType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CommandEvent.html">CommandEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CursorType.html">CursorType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DataCodingStrategy.html">DataCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DateCodingStrategy.html">DateCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/FullDocument.html">FullDocument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Hint.html">Hint</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OperationType.html">OperationType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ReturnDocument.html">ReturnDocument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/SDAMEvent.html">SDAMEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UUIDCodingStrategy.html">UUIDCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/WriteModel.html">WriteModel</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSRegularExpression.html">NSRegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UUID.html">UUID</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions.html#/s:10MongoSwift07cleanupaB0yyF">cleanupMongoSwift()</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CodingStrategyProvider.html">CodingStrategyProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CommandEventHandler.html">CommandEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/LabeledError.html">LabeledError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:10MongoSwift0A5ErrorP">MongoError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:10MongoSwift12RuntimeErrorP">RuntimeError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SDAMEventHandler.html">SDAMEventHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:10MongoSwift11ServerErrorP">ServerError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols.html#/s:10MongoSwift9UserErrorP">UserError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Address.html">Address</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/AggregateOptions.html">AggregateOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/AuthenticationError.html">AuthenticationError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCoderOptions.html">BSONCoderOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Binary.html">Binary</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Binary/Subtype.html">– Subtype</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkWriteError.html">BulkWriteError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkWriteFailure.html">BulkWriteFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkWriteOptions.html">BulkWriteOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BulkWriteResult.html">BulkWriteResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ChangeStreamEvent.html">ChangeStreamEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ChangeStreamOptions.html">ChangeStreamOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ClientOptions.html">ClientOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ClientSessionOptions.html">ClientSessionOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Code.html">Code</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CodeWithScope.html">CodeWithScope</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CollectionOptions.html">CollectionOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CollectionSpecification.html">CollectionSpecification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CollectionSpecificationInfo.html">CollectionSpecificationInfo</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CommandError.html">CommandError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CommandFailedEvent.html">CommandFailedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CommandStartedEvent.html">CommandStartedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CommandSucceededEvent.html">CommandSucceededEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CompatibilityError.html">CompatibilityError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ConnectionError.html">ConnectionError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CountDocumentsOptions.html">CountDocumentsOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CreateCollectionOptions.html">CreateCollectionOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/CreateIndexOptions.html">CreateIndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DBPointer.html">DBPointer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DatabaseOptions.html">DatabaseOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DatabaseSpecification.html">DatabaseSpecification</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Decimal128.html">Decimal128</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DeleteModelOptions.html">DeleteModelOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DeleteOptions.html">DeleteOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DeleteResult.html">DeleteResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DistinctOptions.html">DistinctOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Document.html">Document</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DropCollectionOptions.html">DropCollectionOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DropDatabaseOptions.html">DropDatabaseOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DropIndexOptions.html">DropIndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/EstimatedDocumentCountOptions.html">EstimatedDocumentCountOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FindOneAndDeleteOptions.html">FindOneAndDeleteOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FindOneAndReplaceOptions.html">FindOneAndReplaceOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FindOneAndUpdateOptions.html">FindOneAndUpdateOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FindOneOptions.html">FindOneOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/FindOptions.html">FindOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/IndexModel.html">IndexModel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/IndexOptions.html">IndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InsertManyResult.html">InsertManyResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InsertOneOptions.html">InsertOneOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InsertOneResult.html">InsertOneResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InternalError.html">InternalError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/InvalidArgumentError.html">InvalidArgumentError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ListCollectionsOptions.html">ListCollectionsOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/LogicError.html">LogicError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/MongoCollection.html">MongoCollection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/MongoDatabase.html">MongoDatabase</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/MongoNamespace.html">MongoNamespace</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ObjectId.html">ObjectId</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ReadConcern.html">ReadConcern</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ReadConcern/Level.html">– Level</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RegularExpression.html">RegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ReplaceOneModelOptions.html">ReplaceOneModelOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ReplaceOptions.html">ReplaceOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ResumeToken.html">ResumeToken</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/RunCommandOptions.html">RunCommandOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerClosedEvent.html">ServerClosedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerDescription.html">ServerDescription</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerDescription/ServerType.html">– ServerType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerDescriptionChangedEvent.html">ServerDescriptionChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerHeartbeatFailedEvent.html">ServerHeartbeatFailedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerHeartbeatStartedEvent.html">ServerHeartbeatStartedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerHeartbeatSucceededEvent.html">ServerHeartbeatSucceededEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerOpeningEvent.html">ServerOpeningEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/ServerSelectionError.html">ServerSelectionError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Symbol.html">Symbol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TLSOptions.html">TLSOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Timestamp.html">Timestamp</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TopologyClosedEvent.html">TopologyClosedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TopologyDescription.html">TopologyDescription</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TopologyDescription/TopologyType.html">– TopologyType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TopologyDescriptionChangedEvent.html">TopologyDescriptionChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/TopologyOpeningEvent.html">TopologyOpeningEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/UpdateDescription.html">UpdateDescription</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/UpdateModelOptions.html">UpdateModelOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/UpdateOptions.html">UpdateOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/UpdateResult.html">UpdateResult</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WriteConcern.html">WriteConcern</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WriteConcern/W.html">– W</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WriteConcernFailure.html">WriteConcernFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WriteError.html">WriteError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/WriteFailure.html">WriteFailure</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:10MongoSwift17InsertManyOptionsa">InsertManyOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:10MongoSwift15ServerErrorCodea">ServerErrorCode</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='mongoswift-bson-library' class='heading'>MongoSwift BSON Library</h1>

<p>MongoDB stores and transmits data in the form of <a href="bsonspec.org">BSON</a> documents, and MongoSwift provides a libary that can be used to work with such documents. The following is an example of some of the functionality provided as part of that:</p>
<pre class="highlight swift"><code><span class="c1">// Document construction.</span>
<span class="k">let</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span>
    <span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span><span class="p">,</span>
    <span class="s">"projects"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">"Documentation"</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]</span>
<span class="c1">// Reading from documents.</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span> <span class="c1">// .string(Bob)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"projects"</span><span class="p">])</span> <span class="c1">// .array([.document({ "id": 76, "title": "Documentation" })])</span>

<span class="c1">// Document serialization and deserialization.</span>
<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">occupation</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="k">try</span> <span class="kt">BSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">))</span> <span class="c1">// Person(name: "Bob", occupation: "Software Engineer")</span>
<span class="nf">print</span><span class="p">(</span><span class="k">try</span> <span class="kt">BSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Ted"</span><span class="p">,</span> <span class="nv">occupation</span><span class="p">:</span> <span class="s">"Janitor"</span><span class="p">))</span> <span class="c1">// { "name": "Ted", "occupation": "Janitor" }</span>
</code></pre>

<p>This guide will serve as an overview of various parts of the BSON library. To learn more specifics and cover the entirety of the API surface, please refer to the driver&rsquo;s <a href="https://mongodb.github.io/mongo-swift-driver/">API reference</a>.</p>
<h2 id='bson-values' class='heading'>BSON values</h2>

<p>BSON values have many possible types, ranging from simple 32-bit integers to documents which store more BSON values themselves. To accurately model this, the driver defines the <code><a href="Enums/BSON.html">BSON</a></code> enum, which has a distinct case for each BSON type. For the more simple cases such as BSON null, the case has no associated value. For the more complex ones, such as documents, a separate type is defined that the case wraps. Where possible, the enum case will wrap the standard library/Foundation equivalent (e.g. <code>Double</code>, <code>String</code>, <code>Date</code>)</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">BSON</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="n">null</span><span class="p">,</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">document</span><span class="p">(</span><span class="kt">Document</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="kt">Double</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="c1">// ...rest of the cases...</span>
<span class="p">}</span>
</code></pre>
<h3 id='initializing-a-code-bson-code' class='heading'>Initializing a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>This enum can be instantiated directly like any other enum in the Swift language, but it also conforms to a number of <code>ExpressibleByXLiteral</code> protocols, meaning it can be instantiated directly from numeric, string, boolean, dictionary, and array literals.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1">// .int64(5) on 64-bit systems</span>
<span class="k">let</span> <span class="nv">double</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mf">5.5</span> <span class="c1">// .double(5.5)</span>
<span class="k">let</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="s">"hello world"</span> <span class="c1">// .string("hello world")</span>
<span class="k">let</span> <span class="nv">bool</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">// .bool(false)</span>
<span class="k">let</span> <span class="nv">document</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">"y"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]]</span> <span class="c1">// .document({ "x": 5, "y": true, "z": { "x": 1 } })</span>
<span class="k">let</span> <span class="nv">array</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">]</span> <span class="c1">// .array([.string("1"), .bool(true), .double(5.5)])</span>
</code></pre>

<p>All other cases must be initialized directly:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">BSON</span><span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">())</span>
<span class="k">let</span> <span class="nv">objectId</span> <span class="o">=</span> <span class="kt">BSON</span><span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="kt">ObjectId</span><span class="p">())</span>
<span class="c1">// ...rest of cases...</span>
</code></pre>
<h3 id='unwrapping-a-code-bson-code' class='heading'>Unwrapping a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>To get a <code><a href="Enums/BSON.html">BSON</a></code> value as a specific type, you can use <code>switch</code> or <code>if/guard case let</code> like any other enum in Swift:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">x</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="n">int32</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got an Int32: </span><span class="se">\(</span><span class="n">int32</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="n">oid</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got an objectId: </span><span class="se">\(</span><span class="n">oid</span><span class="o">.</span><span class="n">hex</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got something else"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">InvalidArgumentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"y must be a double"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>While these methods are good for branching, sometimes it is useful to get just the value (e.g. for optional chaining, passing as a parameter, or returning from a function). For those cases, <code><a href="Enums/BSON.html">BSON</a></code> has computed properties for each case that wraps a type. These properties will return <code>nil</code> unless the underlying BSON value is an exact match to the return type of the property.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Document</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">documents</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">arrayValue</span><span class="p">?</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">documentValue</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"x is not an array"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">documents</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int32Value</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int32Value</span><span class="p">)</span> <span class="c1">// Int32(5)</span>
<span class="nf">print</span><span class="p">(</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int64Value</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">doubleValue</span><span class="p">)</span> <span class="c1">// Double(5.0)</span>
</code></pre>
<h3 id='converting-a-code-bson-code' class='heading'>Converting a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>In some cases, especially when dealing with numbers, it may make sense to coerce a <code><a href="Enums/BSON.html">BSON</a></code>&lsquo;s wrapped value into a similar one. For those situations, there are several conversion methods defined on <code><a href="Enums/BSON.html">BSON</a></code> that will unwrap the underlying value and attempt to convert it to the desired type. If that conversion would be lossless, a non-<code>nil</code> value is returned. </p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nf">asInt</span><span class="p">(),</span> <span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">UserError</span><span class="o">.</span><span class="nf">invalidArugmentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"provide two integer types"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nv">y</span><span class="p">:</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c1">// 10</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">5.01</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// error</span>
<span class="k">try</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="s">"5"</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// error</span>
</code></pre>

<p>There are similar conversion methods for the other types, namely <code>asInt32()</code>, <code>asDouble()</code>, <code>asInt64()</code>, and <code>asDecimal128()</code>.</p>
<h3 id='using-a-code-bson-code-value' class='heading'>Using a <code><a href="Enums/BSON.html">BSON</a></code> value</h3>

<p><code><a href="Enums/BSON.html">BSON</a></code> conforms to a number of useful Foundation protocols, namely <code>Codable</code>, <code>Equatable</code>, and <code>Hashable</code>. This allows them to be compared, encoded/decoded, and used as keys in maps:</p>
<pre class="highlight swift"><code><span class="c1">// Codable conformance synthesized by compiler.</span>
<span class="kd">struct</span> <span class="kt">X</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">_id</span><span class="p">:</span> <span class="kt">BSON</span>
<span class="p">}</span>
<span class="c1">// Equatable</span>
<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="s">"5"</span>
<span class="k">let</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">let</span> <span class="nv">z</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="s">"5"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1">// false</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span> <span class="c1">// true</span>
<span class="c1">// Hashable</span>
<span class="k">let</span> <span class="nv">map</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSON</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
    <span class="nv">false</span><span class="p">:</span> <span class="s">"bool"</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span> <span class="s">"array"</span><span class="p">,</span>
    <span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="kt">ObjectId</span><span class="p">()):</span> <span class="s">"oid"</span><span class="p">,</span>
    <span class="o">.</span><span class="nv">null</span><span class="p">:</span> <span class="s">"null"</span><span class="p">,</span>
    <span class="o">.</span><span class="nv">maxKey</span><span class="p">:</span> <span class="s">"maxKey"</span>
<span class="p">]</span>
</code></pre>
<h2 id='documents' class='heading'>Documents</h2>

<p>BSON documents are the top-level structures that contain the aforementioned BSON values, and they are also BSON values themselves. The driver defines the <code><a href="Structs/Document.html">Document</a></code> struct to model this specific BSON type.</p>
<h3 id='initializing-documents' class='heading'>Initializing documents</h3>

<p>Like <code><a href="Enums/BSON.html">BSON</a></code>, <code><a href="Structs/Document.html">Document</a></code> can also be initialized by a dictionary literal. The elements within the literal must be <code><a href="Enums/BSON.html">BSON</a></code>s, so further literals can be embedded within the top level literal definition:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s">"y"</span><span class="p">:</span> <span class="mf">5.5</span>
    <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">())]</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre>

<p>Documents can also be initialized directly by passing in a <code>Data</code> containing raw BSON bytes. If the bytes do not constitute valid BSON, an error is thrown.</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Document</span><span class="p">(</span><span class="nv">fromBSON</span><span class="p">:</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">hexString</span><span class="p">:</span> <span class="s">"0F00000010246B6579002A00000000"</span><span class="p">))</span> <span class="c1">// { "$key": 42 }</span>
<span class="k">try</span> <span class="kt">Document</span><span class="p">(</span><span class="nv">fromBSON</span><span class="p">:</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">hexString</span><span class="p">:</span> <span class="s">"1200000002666F6F0004000000626172"</span><span class="p">))</span> <span class="c1">// error </span>
</code></pre>

<p>Documents may be initialized from an <a href="https://docs.mongodb.com/manual/reference/mongodb-extended-json/">extended JSON</a> string as well:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">Document</span><span class="p">(</span><span class="nv">fromJSON</span><span class="p">:</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">x</span><span class="se">\"</span><span class="s">: true }"</span><span class="p">)</span> <span class="c1">// { "x": true }</span>
<span class="k">try</span> <span class="kt">Document</span><span class="p">(</span><span class="nv">fromJSON</span><span class="p">:</span> <span class="s">"{ x: false }}}"</span><span class="p">)</span> <span class="c1">// error</span>
</code></pre>
<h3 id='using-documents' class='heading'>Using documents</h3>

<p>Documents define the interface in which an application communicates with a MongoDB deployment. For that reason, <code><a href="Structs/Document.html">Document</a></code> has been fitted with functionality to make it both powerful and ergonomic to use for developers.</p>
<h4 id='reading-writing-to-code-document-code' class='heading'>Reading / writing to <code><a href="Structs/Document.html">Document</a></code></h4>

<p><code><a href="Structs/Document.html">Document</a></code> conforms to <a href="https://developer.apple.com/documentation/swift/collection"><code>Collection</code></a>, which allows for easy reading and writing of elements via the subscript operator. On <code><a href="Structs/Document.html">Document</a></code>, this operator returns and accepts a <code>BSON?</code>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// .int64(1)</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"y"</span><span class="p">:</span> <span class="o">.</span><span class="n">null</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// .document({ "y": null })</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">// { }</span>
</code></pre>

<p><code><a href="Structs/Document.html">Document</a></code> also has the <code>@dynamicMemberLookup</code> attribute, meaning it&rsquo;s values can be accessed directly as if they were properties on <code><a href="Structs/Document.html">Document</a></code>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// .int64(1)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s">"y"</span><span class="p">:</span> <span class="o">.</span><span class="n">null</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// .document({ "y": null })</span>
<span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">// { }</span>
</code></pre>

<p><code><a href="Structs/Document.html">Document</a></code> also conforms to <a href="https://developer.apple.com/documentation/swift/sequence"><code>Sequence</code></a>, which allows it to be iterated over:</p>
<pre class="highlight swift"><code><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">in</span> <span class="kt">Document</span> <span class="p">{</span> 
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">k</span><span class="se">)</span><span class="s"> = </span><span class="se">\(</span><span class="n">v</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Conforming to <code>Sequence</code> also gives a number of useful methods from the functional programming world, such as <code>map</code> or <code>allSatisfy</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">allEvens</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">allSatisfy</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">v</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span> <span class="p">??</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">squares</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">v</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span><span class="o">!</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span><span class="o">!</span> <span class="p">}</span>
</code></pre>

<p>See the documentation for <code>Sequence</code> for a full list of methods that <code><a href="Structs/Document.html">Document</a></code> implements as part of this.</p>

<p>In addition to those protocol conformances, there are a few one-off helpers implemented on <code><a href="Structs/Document.html">Document</a></code> such as <code>filter</code> (that returns a <code><a href="Structs/Document.html">Document</a></code>) and <code>mapValues</code> (also returns a <code><a href="Structs/Document.html">Document</a></code>):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">doc</span> <span class="o">=</span> <span class="p">[</span><span class="s">"_id"</span><span class="p">:</span> <span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="kt">ObjectId</span><span class="p">()),</span> <span class="s">"numCats"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">"numDollars"</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">,</span> <span class="s">"numPhones"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">doc</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">k</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"num"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">}</span><span class="o">.</span><span class="n">mapValues</span> <span class="p">{</span> <span class="n">v</span> <span class="k">in</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="nf">asInt64</span><span class="p">()</span><span class="o">!</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// { "numCats": 7, "numPhones": 6 }</span>
</code></pre>

<p>See the driver&rsquo;s documentation for a full listing of <code><a href="Structs/Document.html">Document</a></code>&rsquo;s public API.</p>
<h2 id='code-codable-code-and-code-document-code' class='heading'><code>Codable</code> and <code><a href="Structs/Document.html">Document</a></code></h2>

<p><a href="https://developer.apple.com/documentation/swift/codable"><code>Codable</code></a> is a protocol defined in Foundation that allows for ergonomic conversion between various serialization schemes and Swift data types. As part of the BSON library, MongoSwift defines both <code><a href="Classes/BSONEncoder.html">BSONEncoder</a></code> and <code><a href="Classes/BSONDecoder.html">BSONDecoder</a></code> to facilitate this serialization and deserialization to and from BSON via <code>Codable</code>. This allows applications to work with BSON documents in a type-safe way, and it removes much of the runtime key presence and type checking required when working with raw documents. It is reccommended that users leverage <code>Codable</code> wherever possible in their applications that use the driver instead of accessing documents directly. </p>

<p>For example, here is an function written using raw documents:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">person</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span>
    <span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span>
    <span class="s">"projects"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Server Side Swift Application"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Write documentation"</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="kd">func</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"name"</span><span class="p">]?</span><span class="o">.</span><span class="n">stringValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nf">argumentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"missing name"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Name: </span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">occupation</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"occupation"</span><span class="p">]?</span><span class="o">.</span><span class="n">stringValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nf">argumentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"missing occupation"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Occupation: </span><span class="se">\(</span><span class="n">occupation</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">projects</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"projects"</span><span class="p">]?</span><span class="o">.</span><span class="n">arrayValue</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">documentValue</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nf">argumentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"missing projects"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Projects:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">project</span> <span class="k">in</span> <span class="n">projects</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="n">project</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nf">argumentError</span><span class="p">(</span><span class="nv">message</span><span class="p">:</span> <span class="s">"missing title"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Due to the flexible nature of <code><a href="Structs/Document.html">Document</a></code>, a number of checks have to be put into the body of the function. This clutters the actual function&rsquo;s logic and requires a lot of boilerplate code. Now, consider the following function which does the same thing but is written leveraging <code>Codable</code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Project</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">BSON</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">occupation</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">projects</span><span class="p">:</span> <span class="p">[</span><span class="kt">Project</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">person</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">BSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Name: </span><span class="se">\(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Occupation: </span><span class="se">\(</span><span class="n">person</span><span class="o">.</span><span class="n">occupation</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Projects:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">project</span> <span class="k">in</span> <span class="n">person</span><span class="o">.</span><span class="n">projects</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In this version, the definition of the data type and the logic of the function are defined completely separately, and it leads to far more readable and concise versions of both. </p>
<h3 id='code-codable-code-in-mongoswift' class='heading'><code>Codable</code> in MongoSwift</h3>

<p>There are a number of ways for users to leverage <code>Codable</code> via driver&rsquo;s API. One such example is through <code><a href="Structs/MongoCollection.html">MongoCollection&lt;T&gt;</a></code>. By default, <code>MongoDatabase.collection</code> returns a <code><a href="Structs/MongoCollection.html">MongoCollection&lt;Document&gt;</a></code>. Any <code>find</code> or <code>aggregate</code> method invocation on that returned collection would then return a <code><a href="Classes/MongoCursor.html">MongoCursor&lt;Document&gt;</a></code>, which when iterated returns a <code>Document?</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">collection</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="nf">collection</span><span class="p">(</span><span class="s">"person"</span><span class="p">,</span> <span class="nv">withType</span><span class="p">:</span> <span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="k">for</span> <span class="n">person</span> <span class="k">in</span> <span class="k">try</span> <span class="n">collection</span><span class="o">.</span><span class="nf">find</span><span class="p">([</span><span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span><span class="p">])</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">person</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="p">??</span> <span class="s">"nil"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">try</span> <span class="n">collection</span><span class="o">.</span><span class="nf">insert</span><span class="p">([</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"New Hire"</span><span class="p">,</span> <span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Doctor"</span><span class="p">,</span> <span class="s">"projects"</span><span class="p">:</span> <span class="p">[])</span>
</code></pre>

<p>However, if the schema of the collection is known, <code>Codable</code> structs can be used to work with the data in a more type safe way. To facilitate this, the alternate <code>collection(name:asType)</code> method on <code><a href="Structs/MongoDatabase.html">MongoDatabase</a></code>, which accepts a <code>Codable</code> generic type, can be used. The provided type defines the model for all the documents in that collection, and any cursor returned from <code>find</code> or <code>aggregate</code> on that collection will be generic over that type instead of <code><a href="Structs/Document.html">Document</a></code>. Iterating such cursors will automatically decode the result documents to the generic type specified. Similarly, <code>insert</code> on that collection will accept an instance of that type.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">collection</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="nf">collection</span><span class="p">(</span><span class="s">"person"</span><span class="p">,</span> <span class="nv">withType</span><span class="p">:</span> <span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="k">for</span> <span class="n">person</span> <span class="k">in</span> <span class="k">try</span> <span class="n">collection</span><span class="o">.</span><span class="nf">find</span><span class="p">([</span><span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span><span class="p">])</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">try</span> <span class="n">collection</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"New Hire"</span><span class="p">,</span> <span class="nv">occupation</span><span class="p">:</span> <span class="s">"Doctor"</span><span class="p">,</span> <span class="nv">projects</span><span class="p">:</span> <span class="p">[])</span>
</code></pre>

<p>This allows applications that interact with the database to use well-defined Swift types, resulting in clearer and less error-prone code. Similar things can be done with <code><a href="Classes/ChangeStream.html">ChangeStream&lt;T&gt;</a></code> and <code><a href="Structs/ChangeStreamEvent.html">ChangeStreamEvent&lt;T&gt;</a></code>.</p>
<h2 id='migrating-from-the-old-bson-api' class='heading'>Migrating from the old BSON API</h2>

<p>In version 0.2.0 of <code>MongoSwift</code>, the public API for using BSON values was changed dramatically. This section will describe the process for migrating from the old API (BSON API v1) to this new one (BSON API v2).</p>
<h3 id='overview-of-bson-api-v1' class='heading'>Overview of BSON API v1</h3>

<p>The previous API was based around the <code>BSONValue</code> protocol. Types that conformed to this protocol could be inserted to or read out of <code><a href="Structs/Document.html">Document</a></code> and could aslo be used in <code><a href="Structs/Document.html">Document</a></code> literals. The protocol was also used in various places around the driver as an existential type or conformance requirement. A related protocol, <code>BSONNumber</code>, inherited from <code>BSONValue</code> and provided some numeric conversion helpers for the various BSON number types (e.g. <code>Double</code>, <code>Int32</code>, <code>Int</code>). </p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"a"</span><span class="p">:</span> <span class="mi">5</span>
    <span class="s">"b"</span><span class="p">:</span> <span class="kt">ObjectId</span><span class="p">()</span>
<span class="p">]</span>
<span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">BSONValue</span><span class="p">?</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"a"</span><span class="p">]</span> <span class="c1">// 5</span>
<span class="k">let</span> <span class="nv">intValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="k">as?</span> <span class="kt">BSONNumber</span><span class="p">)?</span><span class="o">.</span><span class="n">int32Value</span> <span class="c1">// Int32(5)</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"c"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"i am a string"</span>
</code></pre>

<p>This API provided a number of benefits, the principal one being the seamless integration of standard Swift types (e.g. <code>Int</code>) and driver custom ones (e.g <code><a href="Structs/ObjectId.html">ObjectId</a></code>) into <code><a href="Structs/Document.html">Document</a></code>&rsquo;s methods. It also had a few drawbacks, however. In order for <code>BSONValue</code> to be used as an existential type, it could not have <code>Self</code> or associated type requirements. This ended being a big restriction as it meant <code>BSONValue</code> could not be <code>Equatable</code>, <code>Hashable</code>, or <code>Codable</code>. Instead, all of this functionaltiy was put onto the separate wrapper type <code>AnyBSONValue</code>, which was used instead of an existential <code>BSONValue</code> in many places in order to leverage these common protocol conformances.</p>

<p>Another drawback is that subdocument literals could not be inferred and had to be explicitly casted:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"y"</span><span class="p">:</span> <span class="p">[</span>
            <span class="nv">z</span><span class="p">:</span> <span class="mi">4</span>
        <span class="p">]</span> <span class="k">as</span> <span class="kt">Document</span>
    <span class="p">]</span> <span class="k">as</span> <span class="kt">Document</span>
<span class="p">]</span>
</code></pre>
<h3 id='required-updates' class='heading'>Required Updates</h3>

<p>In BSON API v2, <code>BSONNumber</code>, <code>BSONValue</code>, and <code>AnyBSONValue</code> no longer exist. They are all entirely replaced by the <code><a href="Enums/BSON.html">BSON</a></code> enum.</p>
<h4 id='updating-code-bsonvalue-code-references' class='heading'>Updating <code>BSONValue</code> references</h4>

<p>Anywhere in the driver that formerly accepted or returned a <code>BSONValue</code> will now accept or return a <code><a href="Enums/BSON.html">BSON</a></code>. Wherever <code>BSONValue</code> is used as an existential value in your application, a <code><a href="Enums/BSON.html">BSON</a></code> will probably work as a drop-in replacement. Any casts will need to be updated to call the appropriate helper property instead.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSONValue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">stringValue</span> <span class="o">=</span> <span class="n">x</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">"foo"</span> <span class="o">+</span> <span class="n">stringValue</span>
<span class="p">}</span>
</code></pre>

<p>becomes:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">stringValue</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">stringValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="c1">// or</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="n">stringValue</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">"foo"</span> <span class="o">+</span> <span class="n">stringValue</span>
<span class="p">}</span>
</code></pre>

<p>Similarly, <code><a href="Enums/BSON.html">BSON</a></code>&rsquo;s <code>Equatable</code> conformance can be leveraged instead of the old <code>bsonEquals</code>.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSONValue</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSONValue</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="nf">bsonEquals</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>becomes simply:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><strong>Generic Requirement</strong>
Currently, there is no equivalent protocol in BSON API v2 to <code>BSONValue</code>, so if your application was using it as a generic requirement there is no alternative in the driver. You may have to implement your own similar protocol to achieve the same effect. If such a protocol would be useful to you, please <a href="https://github.com/mongodb/mongo-swift-driver#bugs--feature-requests">file a ticket on the driver&rsquo;s Jira project</a>.</p>
<h4 id='updating-code-bsonnumber-code-references' class='heading'>Updating <code>BSONNumber</code> references</h4>

<p><code><a href="Enums/BSON.html">BSON</a></code> should be a drop-in replacement for anywhere <code>BSONNumber</code> is used, except for as a generic requirement. One thing to note that <code>BSONNumber</code>&rsquo;s properties (e.g. <code>.int32Value</code>) are <em>conversions</em>, whereas <code><a href="Enums/BSON.html">BSON</a></code>&rsquo;s are simple unwraps. The conversions on <code><a href="Enums/BSON.html">BSON</a></code> are implemented as methods (e.g. <code>asInt32()</code>).</p>
<pre class="highlight swift"><code><span class="c1">// old</span>
<span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
    <span class="c1">// conversion</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"a"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">BSONNumber</span><span class="p">)?</span><span class="o">.</span><span class="n">intValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="c1">// cast</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">otherInt</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"b"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int32</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">int</span><span class="o">*</span><span class="kt">Int</span><span class="p">(</span><span class="n">otherInt</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// new</span>
<span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
    <span class="c1">// conversion</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">int</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"a"</span><span class="p">]?</span><span class="o">.</span><span class="nf">asInt</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="c1">// cast</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">otherInt</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"b"</span><span class="p">]?</span><span class="o">.</span><span class="n">int32Value</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="c1">// or can use case let</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="n">otherInt</span><span class="p">)</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"b"</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">int</span> <span class="o">*</span> <span class="kt">Int</span><span class="p">(</span><span class="n">otherInt</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h4 id='updating-code-anybsonvalue-code-references' class='heading'>Updating <code>AnyBSONValue</code> references</h4>

<p><code><a href="Enums/BSON.html">BSON</a></code> should be able to serve as a complete replacement for <code>AnyBSONValue</code>.
<code>Codable</code> usage:</p>
<pre class="highlight swift"><code><span class="c1">// old</span>
<span class="kd">struct</span> <span class="kt">X</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">AnyBSONValue</span>
<span class="p">}</span>
<span class="c1">// new</span>
<span class="kd">struct</span> <span class="kt">X</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span>
<span class="p">}</span>
</code></pre>

<p><code>Equatable</code> usage:</p>
<pre class="highlight swift"><code><span class="c1">// old </span>
<span class="k">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSONValue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">false</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">b</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSONValue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"not"</span><span class="p">,</span> <span class="s">"equal"</span><span class="p">]</span>
<span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">AnyBSONValue</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">AnyBSONValue</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
<span class="c1">// new</span>
<span class="k">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSON</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">false</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">b</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSON</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"not"</span><span class="p">,</span> <span class="s">"equal"</span><span class="p">]</span>
<span class="k">return</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
</code></pre>

<p><code>Hashable</code> usage:</p>
<pre class="highlight swift"><code><span class="c1">// old</span>
<span class="k">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">[</span><span class="kt">AnyBSONValue</span><span class="p">:</span> <span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AnyBSONValue</span><span class="p">(</span><span class="s">"hello"</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="kt">AnyBSONValue</span><span class="p">(</span><span class="kt">ObjectId</span><span class="p">()):</span> <span class="mi">26</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="kt">AnyBSONValue</span><span class="p">(</span><span class="kc">true</span><span class="p">)]</span> <span class="p">??</span> <span class="s">"nil"</span><span class="p">)</span>
<span class="c1">// new</span>
<span class="k">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSON</span><span class="p">,</span> <span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"hello"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="nf">objectId</span><span class="p">(</span><span class="kt">ObjectId</span><span class="p">()):</span> <span class="mi">26</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="kc">true</span><span class="p">]</span> <span class="p">??</span> <span class="s">"nil"</span><span class="p">)</span>
</code></pre>
<h4 id='updating-code-document-code-literals' class='heading'>Updating <code><a href="Structs/Document.html">Document</a></code> literals</h4>

<p><code><a href="Enums/BSON.html">BSON</a></code> can be expressed by a dictionary literal, string literal, integer literal, float literal, boolean literal, and array literal, so document literals consisting of those literals can largely be left alone. All the other types that formerly conformed to <code>BSONValue</code> will need to have their cases explicitly constructed. The cast to <code><a href="Structs/Document.html">Document</a></code> will no longer be required for subdocuments and will need to be removed. All runtime variables will also need to have their cases explicitly constructed whereas in BSON API v1 they could just be inserted directly.</p>
<pre class="highlight swift"><code><span class="c1">// BSON API v1</span>
<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"_id"</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">getDocument</span><span class="p">()</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="kt">Date</span><span class="p">()</span>
    <span class="s">"y"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">123</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Document</span><span class="p">]</span>
    <span class="p">]</span> <span class="k">as</span> <span class="kt">Document</span>
<span class="p">]</span>
</code></pre>

<p>becomes</p>
<pre class="highlight swift"><code><span class="c1">// BSON API v2</span>
<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Document</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"_id"</span><span class="p">:</span> <span class="o">.</span><span class="nf">document</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">getDocument</span><span class="p">())</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">()),</span>
    <span class="s">"y"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">123</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2020 <a class="link" href="https://github.com/mongodb/mongo-swift-driver" target="_blank" rel="external">Matt Broadstone, Kaitlin Mahar, and Patrick Freed</a>. All rights reserved. (Last updated: 2020-02-27)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
